<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELLO SHOP | Premium Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { 
            --primary: #FF4F00; 
            --bg: #f4f7f6; 
            --gray-alert: #333333; 
            --green-tick: #28a745; 
            --red: #e74c3c; 
            --blue: #3498db; 
            --white: #ffffff; 
        }
        body { font-family: 'Poppins', sans-serif; margin:0; background: var(--bg); padding-bottom: 80px; overflow-x: hidden; }
        #loaderOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .spinner-bg { width: 50px; height: 50px; border: 5px solid #e0e0e0; border-top: 5px solid #888888; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #customToast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--gray-alert); color: white; padding: 12px 25px; border-radius: 8px; display: none; z-index: 5000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 14px; text-align: center; }
        #customConfirm { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--gray-alert); color: white; padding: 20px; border-radius: 12px; display: none; z-index: 6000; width: 80%; max-width: 300px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        header { background: var(--primary); color:white; padding:15px; text-align:center; font-weight:bold; font-size:20px; position: sticky; top:0; z-index:1000; }
        .search-area { background: white; padding: 10px; position: sticky; top: 55px; z-index: 999; border-bottom: 1px solid #eee; }
        #searchBar { width: 90%; padding: 10px 15px; display: block; margin: 0 auto; border: 1px solid #ddd; border-radius: 25px; outline: none; }
        #products { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: relative; cursor: pointer; }
        .card img { width: 100%; height: 140px; object-fit: cover; }
        .card-info { padding: 10px; }
        .price-tag { color: var(--primary); font-weight: 700; }
        .btn-group { display: flex; flex-direction: column; gap: 5px; padding: 0 10px 10px; }
        .btn-small { border: none; padding: 8px; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .btn-order { background: var(--primary); color: white; }
        .btn-delete { background: var(--red); color: white; }
        .section { display: none; padding: 15px; }
        .active-section { display: block; }
        input, select, textarea { width: 92%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px; width: 100%; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .slider { display: flex; overflow-x: auto; gap: 10px; scroll-snap-type: x mandatory; margin-bottom: 15px; }
        .slider img { width: 100%; flex-shrink: 0; scroll-snap-align: start; border-radius: 12px; height: 250px; object-fit: cover; }
        .old-price { text-decoration: line-through; color: var(--red); font-size: 14px; margin-right: 10px; }
        .new-price { color: var(--green-tick); font-size: 20px; font-weight: bold; }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: bold; float: right; }
        .stock-badge { display: inline-block; padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 5px; font-size: 12px; margin-bottom: 10px; font-weight: 600; }
        .out-of-stock { background: #ffebee; color: #c62828; }
        .bottomNav { position:fixed; bottom:0; width:100%; height:70px; background: white; display:flex; justify-content:space-around; align-items:center; box-shadow:0 -3px 15px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { background: none; border: none; font-size: 10px; color: #666; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-active { color: var(--primary); font-weight: bold; }
        #chatBtn { position: fixed; right: 20px; bottom: 85px; background: var(--primary); color: white; width: 55px; height: 55px; border-radius: 50%; display: none; justify-content: center; align-items: center; font-size: 24px; z-index: 1001; }
        #chatWindow { position: fixed; right: 15px; bottom: 85px; width: 300px; height: 400px; background: white; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); display: none; flex-direction: column; z-index: 2000; overflow: hidden; border: 1px solid #eee; }
        #chatMessages { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; background: #f9f9f9; }
        .msg { max-width: 80%; padding: 8px 12px; border-radius: 12px; font-size: 13px; }
        .msg-me { align-self: flex-end; background: var(--primary); color: white; }
        .msg-them { align-self: flex-start; background: #eee; color: #333; }
        .msg-header { display: flex; align-items: center; margin-bottom: 5px; font-size: 12px; font-weight: bold; }
        .msg-header img { width: 25px; height: 25px; border-radius: 50%; margin-right: 5px; }
        .msg-me .msg-header { flex-direction: row-reverse; text-align: right; }
        .msg-them .msg-header { text-align: left; }
        .user-pic-container { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; margin: 0 auto 10px; border: 3px solid var(--primary); }
        .payment-card { background: #fff8f5; border: 1px solid #ffccbc; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .admin-select-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }

        /* Login Security Features */
        .pass-container { position: relative; width: 92%; margin: 10px auto; }
        .pass-container input { width: 100%; margin: 0; padding-right: 40px; }
        .toggle-pass { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #999; font-size: 18px; user-select: none; background: transparent; }
        .forgot-link { display: block; margin-top: 15px; color: var(--primary); font-size: 12px; text-decoration: none; cursor: pointer; font-weight: 500; }

        /* Edit Product Section Styles */
        #editProductSection { background: var(--white); padding: 20px; border-radius: 12px; border: 1px solid var(--primary); }
        #editProductSection h3 { color: var(--primary); }
        #editProductSection .btn-main { background: var(--primary); color: var(--white); }
        .preview-img { width: 70px; margin: 5px; border-radius: 8px; }
        #currentVideoPreview { width: 100%; height: 150px; margin-bottom: 10px; }

        /* Order Section for Admin */
        #ordersSection select { background: var(--white); border: 1px solid var(--primary); color: var(--primary); }
        #ordersSection .btn-main { background: var(--primary); color: var(--white); }

        /* Cart Item */
        .cart-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px; margin-bottom: 10px; border: 1px solid #eee; }
        .cart-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
        .cart-item input[type="checkbox"] { margin-right: 10px; }

        /* Google Sign-in Button */
        .google-btn { background: #4285F4; color: white; border: none; padding: 14px; width: 92%; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; position: relative; }
        .google-btn.disabled { background: #ddd; cursor: not-allowed; }
        .lock-icon { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 18px; color: #888; }

        /* Popup for Google */
        #googlePopup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(51, 51, 51, 0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .popup-content { background: #f4f7f6; padding: 20px; border-radius: 12px; text-align: center; width: 80%; max-width: 300px; }
        .popup-content h2 { color: var(--primary); margin-bottom: 10px; }
        .popup-content button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        /* Wallet UI - Updated to Orange (#FF4F00) + White only */
        .wallet-section { 
            background: white; 
            padding: 18px; 
            border-radius: 12px; 
            margin: 20px auto; 
            max-width: 380px; 
            box-shadow: 0 3px 12px rgba(0,0,0,0.08); 
            text-align: center; 
            cursor: pointer; 
            border: 1px solid var(--primary); 
        }
        .wallet-title { 
            color: var(--primary); 
            font-size: 19px; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        .wallet-balance { 
            color: var(--primary); 
            font-size: 28px; 
            font-weight: 700; 
        }
        .wallet-btns { 
            display: flex; 
            gap: 12px; 
            margin-top: 18px; 
            justify-content: center; 
        }
        .wallet-btn { 
            flex: 1; 
            max-width: 160px; 
            padding: 13px; 
            border-radius: 10px; 
            font-weight: 600; 
            cursor: pointer; 
            color: white; 
            background: var(--primary); 
            border: none; 
        }
        .topup-page { 
            background: var(--primary); 
            color: white; 
            padding: 24px 16px; 
            border-radius: 12px; 
        }
        .withdrawal-page { 
            background: var(--red); 
            color: white; 
            padding: 24px 16px; 
            border-radius: 12px; 
        }
        .payment-details { 
            background: var(--primary); 
            color: white; 
            padding: 16px; 
            border-radius: 10px; 
            margin: 16px 0; 
        }
        .payment-details p { 
            margin: 8px 0; 
            font-size: 15px; 
        }
        .request-card { 
            background: white; 
            padding: 16px; 
            border-radius: 10px; 
            margin-bottom: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            border-left: 4px solid var(--primary); 
        }
        .request-card h4 { 
            margin: 0 0 10px; 
            color: var(--primary); 
            font-size: 17px; 
        }
        .request-actions { 
            display: flex; 
            gap: 10px; 
            margin-top: 12px; 
            flex-wrap: wrap; 
        }
    </style>
</head>
<body>

<div id="loaderOverlay"><div class="spinner-bg"></div></div>
<div id="customToast">Notification</div>

<div id="customConfirm">
    <p id="confirmMsg" style="margin-bottom:20px;">Are you sure?</p>
    <div style="display:flex; gap:10px;">
        <button id="confirmOk" class="btn-main" style="padding:8px; font-size:12px;">OK</button>
        <button id="confirmCancel" class="btn-main" style="padding:8px; font-size:12px; background:var(--white); color:var(--primary);">Cancel</button>
    </div>
</div>

<header>HELLO SHOP</header>

<div id="chatBtn" onclick="toggleChat()">üí¨</div>
<div id="chatWindow">
    <div style="background:var(--primary); color:white; padding:12px; font-weight:bold; display:flex; justify-content:space-between;">
        <span>Support</span> <span onclick="toggleChat()" style="cursor:pointer">‚úñ</span>
    </div>
    <div id="chatMessages"></div>
    <div style="display:flex; padding:10px; border-top:1px solid #eee;">
        <input type="text" id="chatInput" placeholder="Message..." style="margin:0; flex:1;">
        <button onclick="sendMsg()" style="border:none; color:var(--primary); background:none; font-weight:bold; padding-left:10px;">Send</button>
    </div>
</div>

<div id="authPage" class="section active-section">
    <div style="text-align: center; padding-top: 50px;">
        <h2 style="color:var(--primary)">Login / Signup</h2>
        <input type="email" id="loginEmail" placeholder="Email">
        <div class="pass-container">
            <input type="password" id="loginPass" placeholder="Password">
            <span class="toggle-pass" onclick="togglePass('loginPass')">üëÅÔ∏è</span>
        </div>
        <button class="btn-main" onclick="handleLogin()" style="width: 92%;">Login</button>
        <button class="btn-main" style="background:#444; margin-top:10px; width: 92%;" onclick="handleSignup()">Create Account</button>
        <button class="google-btn disabled" onclick="showGooglePopup()" style="width: 92%;">Continue with Google <span class="lock-icon">üîí</span></button>
        <a class="forgot-link" onclick="handleForgetPassword()">Forgot Password?</a>
    </div>
</div>

<div id="googlePopup">
    <div class="popup-content">
        <h2>Not available yet</h2>
        <button onclick="closeGooglePopup()">Back</button>
    </div>
</div>

<div id="resetPage" class="section">
    <div style="text-align: center; padding-top: 50px;">
        <h2 style="color:var(--primary)">Set New Password</h2>
        <p style="font-size: 12px; color: #666;">Enter your new password below</p>
        <div class="pass-container">
            <input type="password" id="newPass" placeholder="New Password">
            <span class="toggle-pass" onclick="togglePass('newPass')">üëÅÔ∏è</span>
        </div>
        <button class="btn-main" onclick="updatePassword()" style="width: 92%;">Update Password</button>
    </div>
</div>

<div id="mainApp" style="display:none;">
    <div id="homeSection" class="section active-section">
        <div class="search-area"><input type="text" id="searchBar" placeholder="Search..." onkeyup="searchProducts()"></div>
        <div id="products">Loading...</div>
    </div>

    <div id="adminPanelSection" class="section">
        <div style="background: white; padding: 15px; border-radius: 12px; border:1px solid #ddd;">
            <h3 style="margin-top:0; color:var(--primary)">Admin Panel</h3>
            <input type="text" id="pName" placeholder="Product Name">
            <textarea id="pDesc" placeholder="Description" rows="4"></textarea>
            <input type="number" id="pBasePrice" placeholder="Base Price">
            <input type="number" id="pDiscPrice" placeholder="Discount Price">
            <input type="number" id="pStock" placeholder="Quantity (Stock)">
            <input type="file" id="pImages" accept="image/*" multiple>
            <input type="file" id="pVideo" accept="video/*">
            <button class="btn-main" onclick="addNewProduct()">Add Product</button>
        </div>
    </div>

    <div id="editProductSection" class="section">
        <button onclick="switchSection('homeSection')" style="border:none; background:none; color:var(--primary); font-weight:bold; margin-bottom:15px;">‚Üê Back</button>
        <h3 style="color:var(--primary)">Edit Product</h3>
        <input type="text" id="editPName" placeholder="Product Name">
        <textarea id="editPDesc" placeholder="Description" rows="4"></textarea>
        <input type="number" id="editPBasePrice" placeholder="Base Price">
        <input type="number" id="editPDiscPrice" placeholder="Discount Price">
        <input type="number" id="editPStock" placeholder="Quantity (Stock)">
        <div id="currentImagesPreview"></div>
        <input type="file" id="editPImages" accept="image/*" multiple>
        <div id="currentVideoPreview"></div>
        <input type="file" id="editPVideo" accept="video/*">
        <button class="btn-main" onclick="saveEditedProduct()">Save Changes</button>
    </div>

    <div id="productDetailPage" class="section">
        <button onclick="switchSection('homeSection')" style="border:none; background:none; color:var(--primary); font-weight:bold; margin-bottom:15px;">‚Üê Back</button>
        <div id="detailSlider" class="slider"></div>
        <div id="detailVideo"></div>
        <div id="stockInfo" class="stock-badge"></div>
        <h2 id="detailTitle"></h2>
        <div><span id="detailOldPrice" class="old-price"></span><span id="detailNewPrice" class="new-price"></span></div>
        <p id="detailDescription"></p>
        <div id="detailActionBtn"></div>
    </div>

    <div id="ordersSection" class="section">
        <div class="admin-select-header" id="adminOrderHeader" style="display:none;">
            <h3 style="margin:0;">üì¶ Orders</h3>
            <select id="adminOrderSelect" onchange="toggleOrderDelBtn()"><option value="">Select Order</option></select>
        </div>
        <button id="adminDelOrderBtn" class="btn-main" style="display:none; margin-bottom:15px; background:var(--red);" onclick="deleteSelectedOrder()">Delete Order</button>
        <h3 id="userOrderTitle" style="text-align: center;">üì¶ My Orders</h3>
        <div id="userOrdersList"></div>
    </div>

    <div id="cartSection" class="section">
        <h3>Checkout</h3>
        <div style="position: relative;">
            <div id="cartItems" style="background:#fff; padding:10px; border-radius:8px; margin-bottom:10px;"></div>
            <button id="deleteSelectedCart" class="btn-small btn-delete" style="position: absolute; top: 0; right: 0; display: none;" onclick="deleteSelectedCartItems()">Delete Selected</button>
        </div>
        <button id="checkoutBtn" class="btn-main" style="display:none; margin-bottom:10px;" onclick="showCheckoutForm()">Checkout Selected</button>
        
        <div id="checkoutForm" style="display:none;">
            <label style="font-size:12px; font-weight:bold;">Payment Method</label>
            <select id="payMethodSelect" onchange="togglePaymentUI()">
                <option value="jazzcash">JazzCash (Online)</option>
                <option value="cod" id="codOption" disabled>Cash on Delivery (Only Layyah)</option>
                <option value="wallet" id="walletOption" disabled>HelloShop Wallet (Rs 0)</option>
            </select>
            <div id="codNotice" style="color:red; font-size:10px; margin-top:-5px; display:none;">COD only available in Layyah city.</div>

            <div id="jazzcashDetails" class="payment-card">
                <p style="margin-top:0; font-weight:bold; color:var(--primary)">JazzCash Payment:</p>
                <p style="margin:2px 0; font-size:14px;"><b>Number:</b> 03299469804</p>
                <p style="margin:2px 0; font-size:14px;"><b>Name:</b> SAJAWAL NAZEER</p>
            </div>

            <input type="text" id="orderName" placeholder="Full Name">
            <input type="number" id="orderPhone" placeholder="WhatsApp Number">
            <textarea id="orderAddress" placeholder="Full Address (Mention City)" rows="2" onkeyup="checkLayyahCity()"></textarea>

            <div id="paymentProofUI" style="background:white; padding:10px; border-radius:8px; border:1px solid #ddd; margin-top:10px;">
                <label style="font-size:12px; font-weight:bold;">Transaction ID</label>
                <input type="text" id="orderTrxId" placeholder="Enter Trx ID" style="margin:5px 0;">
                <label style="font-size:12px; font-weight:bold;">Payment Screenshot</label>
                <input type="file" id="orderTrxImg" accept="image/*" style="font-size:11px;">
            </div>
            
            <button class="btn-main" style="margin-top:10px;" onclick="placeOrder()">Confirm Order (Rs <span id="cartTotal">0</span>)</button>
        </div>
    </div>

    <div id="buyNowSection" class="section" style="background: #f4f7f6;">
        <h3>Buy Now</h3>
        <div id="buyNowItem" style="background:#fff; padding:10px; border-radius:8px; margin-bottom:10px;"></div>
        <label style="font-size:12px; font-weight:bold;">Payment Method</label>
        <select id="buyNowPayMethodSelect" onchange="toggleBuyNowPaymentUI()">
            <option value="jazzcash">JazzCash (Online)</option>
            <option value="cod" id="buyNowCodOption" disabled>Cash on Delivery (Only Layyah)</option>
            <option value="wallet" id="buyNowWalletOption" disabled>HelloShop Wallet (Rs 0)</option>
        </select>
        <div id="buyNowCodNotice" style="color:red; font-size:10px; margin-top:-5px; display:none;">COD only available in Layyah city.</div>

        <div id="buyNowJazzcashDetails" class="payment-card">
            <p style="margin-top:0; font-weight:bold; color:var(--primary)">JazzCash Payment:</p>
            <p style="margin:2px 0; font-size:14px;"><b>Number:</b> 03299469804</p>
            <p style="margin:2px 0; font-size:14px;"><b>Name:</b> SAJAWAL NAZEER</p>
        </div>

        <input type="text" id="buyNowOrderName" placeholder="Full Name">
        <input type="number" id="buyNowOrderPhone" placeholder="WhatsApp Number">
        <textarea id="buyNowOrderAddress" placeholder="Full Address (Mention City)" rows="2" onkeyup="checkBuyNowLayyahCity()"></textarea>

        <div id="buyNowPaymentProofUI" style="background:white; padding:10px; border-radius:8px; border:1px solid #ddd; margin-top:10px;">
            <label style="font-size:12px; font-weight:bold;">Transaction ID</label>
            <input type="text" id="buyNowOrderTrxId" placeholder="Enter Trx ID" style="margin:5px 0;">
            <label style="font-size:12px; font-weight:bold;">Payment Screenshot</label>
            <input type="file" id="buyNowOrderTrxImg" accept="image/*" style="font-size:11px;">
        </div>
        
        <button class="btn-main" style="margin-top:10px;" onclick="placeBuyNowOrder()">Confirm Order (Rs <span id="buyNowTotal">0</span>)</button>
    </div>

    <div id="profileSection" class="section">
        <div style="text-align:center">
            <h3 id="userNameDisplay" style="color: var(--primary); margin-bottom: 10px; display: none;"></h3>
            <div class="user-pic-container"><img id="userProfilePic" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" style="width:100%; height:100%; object-fit:cover;"></div>
            <input type="file" id="userPicInput" style="display:none" onchange="uploadProfilePic(this)">
            <button class="btn-main" style="width:60%; font-size:12px; padding:8px; margin-bottom:10px" onclick="document.getElementById('userPicInput').click()">Upload Photo</button>

            <!-- Wallet Display in Profile - Orange theme -->
            <div class="wallet-section" onclick="switchSection('walletSection')">
                <div class="wallet-title">HELLO SHOP WALLET</div>
                <div class="wallet-balance">Rs <span id="walletBalance">0</span></div>
            </div>

            <div id="userNameBook" style="margin-top:20px; text-align:left; background:white; padding:15px; border-radius:10px; border:1px solid #ddd; display:none;">
                <label style="font-weight:bold; font-size:14px;">My Full Name</label>
                <input type="text" id="profileNameInput" placeholder="Enter your full name...">
                <button class="btn-main" style="font-size:12px; padding:8px;" onclick="saveUserName()">Save Name</button>
                <button id="editNameBtn" class="btn-main" style="display:none; font-size:12px; padding:8px; background:var(--blue);" onclick="editUserName()">Edit Name</button>
            </div>

            <div id="userAddressBook" style="margin-top:20px; text-align:left; background:white; padding:15px; border-radius:10px; border:1px solid #ddd; display:none;">
                <label style="font-weight:bold; font-size:14px;">My Address Book</label>
                <textarea id="profileAddressInput" placeholder="Enter your delivery address..." rows="3"></textarea>
                <button class="btn-main" style="font-size:12px; padding:8px;" onclick="saveUserAddress()">Save Address</button>
            </div>

            <div id="adminPaymentProofs" style="display:none; margin-top:20px; text-align:left; background:white; padding:15px; border-radius:10px; border:1px solid #ddd;">
                <div class="admin-select-header">
                    <h4 style="margin:0; color:var(--primary)">Payment Proofs</h4>
                    <select id="adminProofSelect" onchange="toggleProofDelBtn()"><option value="">Select Proof</option></select>
                </div>
                <button id="adminDelProofBtn" class="btn-main" style="display:none; margin-bottom:15px; background:var(--red); padding:8px; font-size:12px;" onclick="deleteSelectedProof()">Delete Proof</button>
                <div id="proofsList" style="font-size:12px;">No proofs yet.</div>
            </div>
            <h3 id="displayEmail" style="margin-top:20px">User</h3>
            <button class="btn-main" style="background:#888" onclick="userLogout()">Logout</button>
        </div>
    </div>

    <!-- Wallet Main Page - Orange + White theme -->
    <div id="walletSection" class="section">
        <h2 style="color:var(--primary); text-align:center; margin-bottom:20px;">HELLO SHOP WALLET</h2>
        <div style="text-align:center; margin:20px 0; background:white; padding:25px; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.08); border:1px solid var(--primary);">
            <div style="font-size:34px; font-weight:700; color:var(--primary);">Rs <span id="walletBalanceDisplay">0</span></div>
            <small style="color:#555;">Available Balance</small>
        </div>

        <div class="wallet-btns">
            <button class="wallet-btn" onclick="switchSection('topupSection')">Top Up Wallet</button>
            <button class="wallet-btn" style="background:var(--red);" onclick="switchSection('withdrawalSection')">Withdrawal</button>
        </div>

        <h3 style="margin:35px 0 15px; color:var(--primary); text-align:center;">Topup Requests</h3>
        <div id="topupRequestsList"></div>

        <h3 style="margin:35px 0 15px; color:var(--primary); text-align:center;">Withdrawal Requests</h3>
        <div id="withdrawalRequestsList"></div>
    </div>

    <!-- Top Up Page - Orange theme -->
    <div id="topupSection" class="section topup-page">
        <h2 style="text-align:center; margin-bottom:20px;">Top Up Wallet</h2>
        <input type="number" id="topupAmount" placeholder="Enter Amount (Rs)" min="100" required>
        <select id="topupMethod" required>
            <option value="">Select Payment Method</option>
            <option value="easypaisa">EasyPaisa</option>
            <option value="jazzcash">JazzCash</option>
            <option value="sadapay">SadaPay</option>
        </select>
        <div class="payment-details">
            <p style="margin:6px 0;"><b>EasyPaisa:</b> 03279491068</p>
            <p style="margin:6px 0;"><b>JazzCash:</b> 03299469804 - SAJAWAL NAZEER</p>
            <p style="margin:6px 0;"><b>SadaPay:</b> 03299469804 - NAZIR HUSSAIN</p>
        </div>
        <input type="text" id="topupTrxId" placeholder="Transaction ID" required>
        <label style="display:block; margin:12px 0 6px; color:white; font-weight:500;">Upload Payment Screenshot</label>
        <input type="file" id="topupScreenshot" accept="image/*" required style="background:white; color:#333; padding:8px; border-radius:6px;">
        <button class="btn-main" style="margin-top:20px;" onclick="sendTopupRequest()">Send Topup Request</button>
    </div>

    <!-- Withdrawal Page -->
    <div id="withdrawalSection" class="section withdrawal-page">
        <h2 style="text-align:center; margin-bottom:20px;">Withdrawal Request</h2>
        <input type="number" id="withdrawalAmount" placeholder="Enter Amount (Rs)" min="500" required>
        <select id="withdrawalMethod" required>
            <option value="">Select Method</option>
            <option value="easypaisa">EasyPaisa</option>
            <option value="jazzcash">JazzCash</option>
        </select>
        <input type="text" id="withdrawalName" placeholder="Account Holder Name" required>
        <input type="text" id="withdrawalNumber" placeholder="Account Number / Mobile Number" required>
        <button class="btn-main" style="background:white; color:var(--red); margin-top:20px;" onclick="sendWithdrawalRequest()">Send Withdrawal Request</button>
    </div>

    <!-- Admin Topup Requests -->
    <div id="adminTopupRequests" class="section">
        <h3 style="color:var(--primary); text-align:center;">Topup Requests (Admin)</h3>
        <div id="adminTopupList"></div>
    </div>

    <!-- Admin Withdrawal Requests -->
    <div id="adminWithdrawalRequests" class="section">
        <h3 style="color:var(--primary); text-align:center;">Withdrawal Requests (Admin)</h3>
        <div id="adminWithdrawalList"></div>
    </div>
</div>

<div id="bottomNav" class="bottomNav" style="display:none;">
    <button class="nav-item nav-active" onclick="switchSection('homeSection', this)"><span>üè†</span>Home</button>
    <button id="cartNavBtn" class="nav-item" onclick="switchSection('cartSection', this)"><span>üõí</span>Cart</button>
    <button class="nav-item" onclick="switchSection('ordersSection', this)"><span>üì¶</span>Orders</button>
    <button id="adminNavBtn" class="nav-item" style="display:none" onclick="switchSection('adminPanelSection', this)"><span>‚öôÔ∏è</span>Admin</button>
    <button class="nav-item" onclick="switchSection('profileSection', this)"><span>üë§</span>Profile</button>
</div>

<script>
const SUPABASE_URL = "https://urrqpsmhlzldtxzstnuu.supabase.co";
const SUPABASE_KEY = "sb_publishable_OmqQDQdf7ye8KXbviwFYng_zPdbZpWb";
const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const ADMIN_EMAIL = "ligerplaz@gmail.com";
let currentUser = null, isAdmin = false, allProducts = [], currentDetailProduct = null, userSavedAddress = "", userSavedName = "", editingProduct = null;
let confirmCallback = null, userProfiles = {}, walletBalance = 0;

function togglePass(id) {
    const p = document.getElementById(id);
    p.type = p.type === 'password' ? 'text' : 'password';
}

async function handleForgetPassword() {
    const email = loginEmail.value.trim();
    if(!email) return showToast("Enter your email first!");
    loaderOverlay.style.display = 'flex';
    const { error } = await _supabase.auth.resetPasswordForEmail(email);
    loaderOverlay.style.display = 'none';
    if(error) showToast(error.message);
    else showToast("Password reset link sent to email!");
}

async function updatePassword() {
    const pass = newPass.value.trim();
    if(pass.length < 6) return showToast("Min 6 characters required");
    loaderOverlay.style.display = 'flex';
    const { error } = await _supabase.auth.updateUser({ password: pass });
    loaderOverlay.style.display = 'none';
    if(error) showToast(error.message);
    else { showToast("Password Updated! Logged in."); location.reload(); }
}

function openConfirm(msg, callback) {
    document.getElementById('confirmMsg').innerText = msg;
    document.getElementById('customConfirm').style.display = 'block';
    confirmCallback = callback;
}
document.getElementById('confirmOk').onclick = () => {
    document.getElementById('customConfirm').style.display = 'none';
    if(confirmCallback) confirmCallback();
};
document.getElementById('confirmCancel').onclick = () => { document.getElementById('customConfirm').style.display = 'none'; };

function showGooglePopup() {
    document.getElementById('googlePopup').style.display = 'flex';
}

function closeGooglePopup() {
    document.getElementById('googlePopup').style.display = 'none';
}

function checkLayyahCity() {
    const addr = document.getElementById('orderAddress').value.toLowerCase();
    const codOpt = document.getElementById('codOption');
    const notice = document.getElementById('codNotice');
    if(addr.includes("layyah")) {
        codOpt.disabled = false;
        notice.style.display = 'none';
    } else {
        codOpt.disabled = true;
        notice.style.display = 'block';
        if(document.getElementById('payMethodSelect').value === 'cod') {
            document.getElementById('payMethodSelect').value = 'jazzcash';
            togglePaymentUI();
        }
    }
}

function checkBuyNowLayyahCity() {
    const addr = document.getElementById('buyNowOrderAddress').value.toLowerCase();
    const codOpt = document.getElementById('buyNowCodOption');
    const notice = document.getElementById('buyNowCodNotice');
    if(addr.includes("layyah")) {
        codOpt.disabled = false;
        notice.style.display = 'none';
    } else {
        codOpt.disabled = true;
        notice.style.display = 'block';
        if(document.getElementById('buyNowPayMethodSelect').value === 'cod') {
            document.getElementById('buyNowPayMethodSelect').value = 'jazzcash';
            toggleBuyNowPaymentUI();
        }
    }
}

function togglePaymentUI() {
    const method = document.getElementById('payMethodSelect').value;
    const proofUI = document.getElementById('paymentProofUI');
    const jcDetails = document.getElementById('jazzcashDetails');
    if(method === 'cod') {
        proofUI.style.display = 'none';
        jcDetails.style.display = 'none';
    } else if(method === 'wallet') {
        proofUI.style.display = 'none';
        jcDetails.style.display = 'none';
    } else {
        proofUI.style.display = 'block';
        jcDetails.style.display = 'block';
    }
}

function toggleBuyNowPaymentUI() {
    const method = document.getElementById('buyNowPayMethodSelect').value;
    const proofUI = document.getElementById('buyNowPaymentProofUI');
    const jcDetails = document.getElementById('buyNowJazzcashDetails');
    if(method === 'cod') {
        proofUI.style.display = 'none';
        jcDetails.style.display = 'none';
    } else if(method === 'wallet') {
        proofUI.style.display = 'none';
        jcDetails.style.display = 'none';
    } else {
        proofUI.style.display = 'block';
        jcDetails.style.display = 'block';
    }
}

async function logVisitor() {
    if(currentUser && currentUser.email === ADMIN_EMAIL) return;
    try {
        let loc = "Unknown Location";
        try { const res = await fetch('https://ipapi.co/json/'); const data = await res.json(); if(data.city) loc = `${data.city}, ${data.country_name}`; } catch(e){}
        await _supabase.from('visitors').insert([{ email: currentUser?.email || "Guest", location: loc }]);
        const old = new Date(Date.now() - 86400000).toISOString();
        await _supabase.from('visitors').delete().lt('created_at', old);
    } catch(e) {}
}

async function handleLogin() {
    const e = loginEmail.value.trim(), p = loginPass.value.trim();
    if(!e || !p) return showToast("Enter credentials");
    loaderOverlay.style.display = 'flex';
    const { data, error } = await _supabase.auth.signInWithPassword({ email: e, password: p });
    loaderOverlay.style.display = 'none';
    if(error) return showToast(error.message);
    currentUser = data.user; localStorage.setItem('helloShopUser', JSON.stringify(data.user)); setupApp(e);
    logVisitor();
}

async function handleSignup() {
    const { error } = await _supabase.auth.signUp({ email: loginEmail.value, password: loginPass.value });
    if(error) showToast(error.message); else showToast("Check Email!");
}

window.onload = () => {
    if(window.location.hash.includes('type=recovery')) {
        document.getElementById('authPage').style.display = 'none';
        document.getElementById('resetPage').style.display = 'block';
        return;
    }
    const saved = localStorage.getItem('helloShopUser');
    if(saved) { currentUser = JSON.parse(saved); setupApp(currentUser.email); logVisitor(); } else { logVisitor(); }
};

function setupApp(email) {
    isAdmin = (email === ADMIN_EMAIL);
    document.getElementById('authPage').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    document.getElementById('bottomNav').style.display = 'flex';
    document.getElementById('chatBtn').style.display = 'flex';
    if(isAdmin) {
        document.getElementById('displayEmail').innerHTML = '<span style="color: var(--primary);">ADMIN</span>';
        document.getElementById('adminNavBtn').style.display = 'flex';
        document.getElementById('cartNavBtn').style.display = 'none'; 
        document.getElementById('adminPaymentProofs').style.display = 'block';
        document.getElementById('adminOrderHeader').style.display = 'flex';
        document.getElementById('userOrderTitle').style.display = 'none';
        fetchProofs();
        loadAdminTopupRequests();
        loadAdminWithdrawalRequests();
    } else {
        document.getElementById('displayEmail').innerText = email;
        document.getElementById('userNameBook').style.display = 'block';
        document.getElementById('userAddressBook').style.display = 'block';
        loadWalletBalance();
        loadTopupRequests();
        loadWithdrawalRequests();
    }
    loadProducts(); fetchOrders(); listenChat(); loadProfileData(); renderCart();
}

async function loadProfileData() {
    const { data } = await _supabase.from('profiles').select('*').eq('email', currentUser.email).maybeSingle();
    if(data) {
        if(data.profile_pic) document.getElementById('userProfilePic').src = data.profile_pic;
        if(data.full_name) {
            userSavedName = data.full_name;
            document.getElementById('userNameDisplay').innerText = data.full_name;
            document.getElementById('userNameDisplay').style.display = 'block';
            document.getElementById('profileNameInput').value = data.full_name;
            document.getElementById('profileNameInput').style.display = 'none';
            document.getElementById('editNameBtn').style.display = 'block';
            document.getElementById('orderName').value = data.full_name;
            document.getElementById('buyNowOrderName').value = data.full_name;
        }
        if(data.address) {
            userSavedAddress = data.address;
            document.getElementById('profileAddressInput').value = data.address;
            document.getElementById('orderAddress').value = data.address;
            document.getElementById('buyNowOrderAddress').value = data.address;
            checkLayyahCity();
            checkBuyNowLayyahCity();
        }
    }
}

async function saveUserName() {
    const name = document.getElementById('profileNameInput').value.trim();
    if (!name) return showToast("Enter your name!");
    loaderOverlay.style.display = 'flex';
    await _supabase.from('profiles').upsert([{ email: currentUser.email, full_name: name }], { onConflict: 'email' });
    userSavedName = name;
    document.getElementById('userNameDisplay').innerText = name;
    document.getElementById('userNameDisplay').style.display = 'block';
    document.getElementById('profileNameInput').style.display = 'none';
    document.getElementById('editNameBtn').style.display = 'block';
    document.getElementById('orderName').value = name;
    document.getElementById('buyNowOrderName').value = name;
    loaderOverlay.style.display = 'none';
    showToast("Name Saved!");
}

function editUserName() {
    document.getElementById('userNameDisplay').style.display = 'none';
    document.getElementById('profileNameInput').style.display = 'block';
    document.getElementById('editNameBtn').style.display = 'none';
}

async function saveUserAddress() {
    const addr = document.getElementById('profileAddressInput').value.trim();
    loaderOverlay.style.display = 'flex';
    await _supabase.from('profiles').upsert([{ email: currentUser.email, address: addr }], { onConflict: 'email' });
    userSavedAddress = addr;
    document.getElementById('orderAddress').value = addr;
    document.getElementById('buyNowOrderAddress').value = addr;
    loaderOverlay.style.display = 'none';
    showToast("Address Saved!");
    checkLayyahCity();
    checkBuyNowLayyahCity();
}

async function uploadProfilePic(input) {
    const reader = new FileReader();
    reader.onload = async (e) => {
        loaderOverlay.style.display = 'flex';
        await _supabase.from('profiles').upsert([{ email: currentUser.email, profile_pic: e.target.result }], { onConflict: 'email' });
        document.getElementById('userProfilePic').src = e.target.result;
        loaderOverlay.style.display = 'none';
        showToast("Photo Updated!");
    };
    reader.readAsDataURL(input.files[0]);
}

async function loadWalletBalance() {
    if (isAdmin) return;
    const { data } = await _supabase.from('profiles').select('wallet_balance').eq('email', currentUser.email).single();
    if (data && data.wallet_balance != null) {
        walletBalance = Number(data.wallet_balance);
        document.getElementById('walletBalance').innerText = walletBalance.toFixed(0);
        document.getElementById('walletBalanceDisplay').innerText = walletBalance.toFixed(0);
        document.getElementById('walletOption').disabled = false;
        document.getElementById('walletOption').innerText = `HelloShop Wallet (Rs ${walletBalance})`;
        document.getElementById('buyNowWalletOption').disabled = false;
        document.getElementById('buyNowWalletOption').innerText = `HelloShop Wallet (Rs ${walletBalance})`;
    }
}

async function loadTopupRequests() {
    if (isAdmin) return;
    const { data } = await _supabase.from('topup_requests').select('*').eq('user_email', currentUser.email).order('created_at', { ascending: false });
    document.getElementById('topupRequestsList').innerHTML = (data || []).map(r => `
        <div class="request-card">
            <h4>Rs ${r.amount} - ${r.method.toUpperCase()}</h4>
            <p>Trx ID: ${r.trx_id || 'N/A'}</p>
            <p>Status: <strong>${r.status.toUpperCase()}</strong></p>
            ${r.status === 'pending' ? `<button class="btn-small btn-delete" onclick="deleteTopupRequest('${r.id}')">Delete</button>` : ''}
            ${r.screenshot ? `<img src="${r.screenshot}" style="max-width:100px; margin-top:5px;">` : ''}
        </div>
    `).join('') || '<p>No topup requests yet.</p>';
}

async function loadWithdrawalRequests() {
    if (isAdmin) return;
    const { data } = await _supabase.from('withdrawal_requests').select('*').eq('user_email', currentUser.email).order('created_at', { ascending: false });
    document.getElementById('withdrawalRequestsList').innerHTML = (data || []).map(r => `
        <div class="request-card">
            <h4>Rs ${r.amount} - ${r.method.toUpperCase()}</h4>
            <p>Name: ${r.name} | Number: ${r.number}</p>
            <p>Status: <strong>${r.status.toUpperCase()}</strong></p>
            ${r.status === 'pending' ? `<button class="btn-small btn-delete" onclick="deleteWithdrawalRequest('${r.id}')">Delete</button>` : ''}
        </div>
    `).join('') || '<p>No withdrawal requests yet.</p>';
}

async function sendTopupRequest() {
    const amount = parseFloat(document.getElementById('topupAmount').value);
    const method = document.getElementById('topupMethod').value;
    const trxId = document.getElementById('topupTrxId').value.trim();
    const screenshotFile = document.getElementById('topupScreenshot').files[0];

    if (!amount || amount < 100) return showToast("Minimum topup amount is Rs 100");
    if (!method) return showToast("Select payment method");
    if (!trxId || !screenshotFile) return showToast("Enter Trx ID and upload screenshot");

    loaderOverlay.style.display = 'flex';

    try {
        const screenshotBase64 = await toBase64(screenshotFile);
        const { error } = await _supabase.from('topup_requests').insert([{
            user_email: currentUser.email,
            amount,
            method,
            trx_id: trxId,
            screenshot: screenshotBase64
        }]);

        if (error) throw error;

        showToast("Topup Request Sent Successfully!");
        switchSection('walletSection');
        loadTopupRequests();
    } catch (err) {
        showToast("Error sending request: " + err.message);
    } finally {
        loaderOverlay.style.display = 'none';
    }
}

async function sendWithdrawalRequest() {
    const amount = parseFloat(document.getElementById('withdrawalAmount').value);
    const method = document.getElementById('withdrawalMethod').value;
    const name = document.getElementById('withdrawalName').value.trim();
    const number = document.getElementById('withdrawalNumber').value.trim();

    if (!amount || amount < 500) return showToast("Minimum withdrawal is Rs 500");
    if (amount > walletBalance) return showToast("Insufficient balance in wallet");
    if (!method || !name || !number) return showToast("Fill all fields");

    loaderOverlay.style.display = 'flex';

    try {
        const { error } = await _supabase.from('withdrawal_requests').insert([{
            user_email: currentUser.email,
            amount,
            method,
            name,
            number
        }]);

        if (error) throw error;

        showToast("Withdrawal Request Sent Successfully!");
        switchSection('walletSection');
        loadWithdrawalRequests();
    } catch (err) {
        showToast("Error sending request: " + err.message);
    } finally {
        loaderOverlay.style.display = 'none';
    }
}

async function deleteTopupRequest(id) {
    openConfirm("Delete this topup request?", async () => {
        await _supabase.from('topup_requests').delete().eq('id', id).eq('user_email', currentUser.email);
        loadTopupRequests();
        showToast("Request deleted");
    });
}

async function deleteWithdrawalRequest(id) {
    openConfirm("Delete this withdrawal request?", async () => {
        await _supabase.from('withdrawal_requests').delete().eq('id', id).eq('user_email', currentUser.email);
        loadWithdrawalRequests();
        showToast("Request deleted");
    });
}

async function loadAdminTopupRequests() {
    if (!isAdmin) return;
    const { data } = await _supabase.from('topup_requests').select('*').order('created_at', { ascending: false });
    document.getElementById('adminTopupList').innerHTML = (data || []).map(r => `
        <div class="request-card">
            <p><b>User:</b> ${r.user_email}</p>
            <p><b>Amount:</b> Rs ${r.amount}</p>
            <p><b>Method:</b> ${r.method}</p>
            <p><b>Trx ID:</b> ${r.trx_id || 'N/A'}</p>
            <p><b>Status:</b> <strong>${r.status}</strong></p>
            ${r.screenshot ? `<img src="${r.screenshot}" style="max-width:150px; margin:10px 0; border-radius:8px;">` : ''}
            ${r.status === 'pending' ? `
                <div class="request-actions">
                    <button class="btn-green" onclick="adminAcceptTopup('${r.id}', ${r.amount}, '${r.user_email}')">Accept</button>
                    <button class="btn-red" onclick="adminRejectTopup('${r.id}')">Reject</button>
                    <button class="btn-delete" onclick="adminDeleteRequest('topup_requests', '${r.id}')">Delete</button>
                </div>
            ` : ''}
        </div>
    `).join('') || '<p>No topup requests.</p>';
}

async function loadAdminWithdrawalRequests() {
    if (!isAdmin) return;
    const { data } = await _supabase.from('withdrawal_requests').select('*').order('created_at', { ascending: false });
    document.getElementById('adminWithdrawalList').innerHTML = (data || []).map(r => `
        <div class="request-card">
            <p><b>User:</b> ${r.user_email}</p>
            <p><b>Amount:</b> Rs ${r.amount}</p>
            <p><b>Method:</b> ${r.method}</p>
            <p><b>Name:</b> ${r.name}</p>
            <p><b>Number:</b> ${r.number}</p>
            <p><b>Status:</b> <strong>${r.status}</strong></p>
            ${r.status === 'pending' ? `
                <div class="request-actions">
                    <button class="btn-green" onclick="adminAcceptWithdrawal('${r.id}', ${r.amount}, '${r.user_email}')">Accept</button>
                    <button class="btn-red" onclick="adminRejectWithdrawal('${r.id}')">Reject</button>
                    <button class="btn-delete" onclick="adminDeleteRequest('withdrawal_requests', '${r.id}')">Delete</button>
                </div>
            ` : ''}
        </div>
    `).join('') || '<p>No withdrawal requests.</p>';
}

async function adminAcceptTopup(id, amount, userEmail) {
    openConfirm("Accept topup and add to wallet?", async () => {
        loaderOverlay.style.display = 'flex';
        try {
            const { data: profile } = await _supabase.from('profiles').select('wallet_balance').eq('email', userEmail).single();
            const current = profile?.wallet_balance || 0;
            await _supabase.from('profiles').update({ wallet_balance: current + amount }).eq('email', userEmail);
            await _supabase.from('topup_requests').update({ status: 'accepted' }).eq('id', id);
            showToast("Topup Accepted!");
            loadAdminTopupRequests();
            if (currentUser.email === userEmail) loadWalletBalance();
        } catch (e) {
            showToast("Error: " + e.message);
        } finally {
            loaderOverlay.style.display = 'none';
        }
    });
}

async function adminRejectTopup(id) {
    openConfirm("Reject this topup request?", async () => {
        await _supabase.from('topup_requests').update({ status: 'rejected' }).eq('id', id);
        showToast("Topup Rejected");
        loadAdminTopupRequests();
    });
}

async function adminAcceptWithdrawal(id, amount, userEmail) {
    openConfirm("Accept withdrawal and deduct from wallet?", async () => {
        loaderOverlay.style.display = 'flex';
        try {
            const { data: profile } = await _supabase.from('profiles').select('wallet_balance').eq('email', userEmail).single();
            const current = profile?.wallet_balance || 0;
            if (current < amount) throw new Error("Insufficient balance now");
            await _supabase.from('profiles').update({ wallet_balance: current - amount }).eq('email', userEmail);
            await _supabase.from('withdrawal_requests').update({ status: 'accepted' }).eq('id', id);
            showToast("Withdrawal Accepted!");
            loadAdminWithdrawalRequests();
            if (currentUser.email === userEmail) loadWalletBalance();
        } catch (e) {
            showToast("Error: " + e.message);
        } finally {
            loaderOverlay.style.display = 'none';
        }
    });
}

async function adminRejectWithdrawal(id) {
    openConfirm("Reject this withdrawal request?", async () => {
        await _supabase.from('withdrawal_requests').update({ status: 'rejected' }).eq('id', id);
        showToast("Withdrawal Rejected");
        loadAdminWithdrawalRequests();
    });
}

async function adminDeleteRequest(table, id) {
    openConfirm("Delete this request?", async () => {
        await _supabase.from(table).delete().eq('id', id);
        if (table === 'topup_requests') loadAdminTopupRequests();
        else loadAdminWithdrawalRequests();
        showToast("Request deleted");
    });
}

function switchSection(id, btn) { 
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none'); 
    document.getElementById(id).style.display = 'block'; 
    if(btn) { 
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active')); 
        btn.classList.add('nav-active'); 
    }
    if(id === 'cartSection') renderCart();
    if(id === 'walletSection' && !isAdmin) {
        loadTopupRequests();
        loadWithdrawalRequests();
    }
}

// Rest of your original script (loadProducts, renderHomeProducts, openDetail, addToCart, placeOrder, placeBuyNowOrder, fetchOrders, renderCart, showToast, userLogout, toggleChat, sendMsg, listenChat, renderMessages, searchProducts, etc.) remains exactly the same as you had
// Paste your full original <script> content here if you want to merge it, but since you said "baqi kuch bhi change na karna" - just keep your original script below this comment

</script>
</body>
</html>
