<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELLO SHOP | Premium Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #F85606; --bg: #f4f7f6; --gray-alert: #333333; --green-tick: #28a745; --red: #e74c3c; }
        body { font-family: 'Poppins', sans-serif; margin:0; background: var(--bg); padding-bottom: 80px; overflow-x: hidden; }

        #loaderOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .spinner-bg { width: 60px; height: 60px; border: 6px solid #ccc; border-top: 6px solid var(--green-tick); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #customToast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--gray-alert); color: white; padding: 12px 25px; border-radius: 8px; display: none; z-index: 5000; align-items: center; gap: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 14px; }

        header { background: var(--primary); color:white; padding:15px; text-align:center; font-weight:bold; font-size:20px; position: sticky; top:0; z-index:1000; }
        .search-area { background: white; padding: 10px; position: sticky; top: 55px; z-index: 999; border-bottom: 1px solid #eee; }
        #searchBar { width: 90%; padding: 10px 15px; display: block; margin: 0 auto; border: 1px solid #ddd; border-radius: 25px; outline: none; }

        #products { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: relative; }
        .card img { width: 100%; height: 140px; object-fit: cover; }
        .card-info { padding: 10px; }
        .price-tag { color: var(--primary); font-weight: 700; }

        .btn-group { display: flex; flex-direction: column; gap: 5px; padding: 0 10px 10px; }
        .btn-small { border: none; padding: 8px; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .btn-cart { background: #eee; }
        .btn-order { background: var(--primary); color: white; }

        .admin-edit-bar { display: none; background: #fff; padding: 5px; justify-content: space-around; border-bottom: 1px solid #eee; }
        .admin-edit-bar button { font-size: 11px; color: var(--primary); border: none; background: none; cursor: pointer; font-weight: bold; }

        .support-btn { position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; z-index: 1500; cursor: pointer; border: none; }

        #proofSection { display: none; background: #fff; padding: 15px; border-radius: 12px; margin-top: 10px; border: 2px solid var(--primary); }

        .bottomNav { position:fixed; bottom:0; width:100%; height:70px; background: white; display:flex; justify-content:space-around; align-items:center; box-shadow:0 -3px 15px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { background: none; border: none; font-size: 10px; color: #666; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-active { color: var(--primary); font-weight: bold; }

        .section { display: none; padding: 15px; }
        .active-section { display: block; }
        input, textarea { width: 92%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px; width: 100%; border-radius: 8px; font-weight: 600; cursor: pointer; }

        .payment-method { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin: 8px 0; cursor: pointer; }
        .payment-method.active { border: 2px solid var(--primary); background: #fff5f0; }
        
        #adminDashboard { display: none; background: #fff; padding: 15px; margin-top: 20px; border-top: 5px solid #333; }
        .preview-img { width: 80px; height: 80px; object-fit: cover; display: none; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>

<div id="loaderOverlay"><div class="spinner-bg"></div></div>
<div id="customToast">Notification</div>

<button class="support-btn" id="supportBtn" style="display:none;" onclick="window.open('https://wa.me/923299469804')">üí¨</button>

<header>HELLO SHOP</header>

<div id="authPage" class="section active-section">
    <div style="text-align: center; padding-top: 50px;">
        <h2 style="color:var(--primary)">Login to Continue</h2>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPass" placeholder="Password">
        <button class="btn-main" onclick="handleLogin()">Login</button>
        <p>New user?</p>
        <button class="btn-main" style="background:#444" onclick="handleSignup()">Signup</button>
    </div>
</div>

<div id="mainApp" style="display:none;">
    <div class="search-area" id="searchContainer">
        <input type="text" id="searchBar" placeholder="Search Products..." onkeyup="searchProducts()">
    </div>

    <div id="homeSection" class="section active-section">
        <div id="products"></div>
        
        <div id="adminDashboard">
            <h3 style="color:var(--primary)">Admin Panel</h3>
            <input type="text" id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Price">
            <label style="font-size:12px; color:#666;">Gallery Image:</label>
            <input type="file" id="pImgFile" accept="image/*" onchange="previewAdminImage(this)">
            <img id="adminPreview" class="preview-img">
            <button class="btn-main" id="adminActionBtn" onclick="addNewProduct()">Add Product</button>
            <hr>
            <h4>Admin Orders View</h4>
            <div id="adminOrdersList"></div>
        </div>
    </div>

    <div id="ordersSection" class="section">
        <h3 style="text-align: center;">üì¶ My Orders</h3>
        <div id="userOrdersList">No orders yet.</div>
    </div>

    <div id="cartSection" class="section">
        <h3 style="text-align: center;">Checkout</h3>
        <div id="cartItems"></div>
        <div id="checkoutForm">
            <input type="text" id="orderName" placeholder="Full Name">
            <input type="number" id="orderPhone" placeholder="WhatsApp / Phone Number">
            <div id="addressList"></div>
            <h4>Payment Method</h4>
            <div class="payment-method active" id="pay-cod" onclick="setPayment('COD')">Cash on Delivery</div>
            <div class="payment-method" id="pay-ep" onclick="setPayment('JazzCash')">JazzCash / Easypaisa</div>
            <div id="paymentInstructions" style="display:none; padding:10px; background:#e3f2fd; border-radius:8px;">
                <b>JazzCash: 03299469804 (SAJAWAL NAZEER)</b>
            </div>
            <button class="btn-main" style="background:var(--green-tick); margin-top:10px" onclick="initiateOrder()">Place Order (Total: Rs <span id="cartTotal">0</span>)</button>
        </div>

        <div id="proofSection">
            <h4>Submit Payment Proof</h4>
            <input type="text" id="tidInput" placeholder="Transaction ID (TID)">
            <input type="file" id="proofImg" accept="image/*">
            <button class="btn-main" onclick="submitProof()">Submit Proof</button>
        </div>
    </div>

    <div id="profileSection" class="section">
        <div style="text-align:center">
            <h3 id="displayEmail">User</h3>
            <div id="savedAddresses"></div>
            <input type="text" id="newAddr" placeholder="New Address">
            <button class="btn-main" onclick="saveAddress()">Add Address</button>
            <button class="btn-main" style="background:#888; margin-top:20px" onclick="location.reload()">Logout</button>
        </div>
    </div>
</div>

<div id="bottomNav" class="bottomNav" style="display:none;">
    <button class="nav-item nav-active" onclick="switchSection('homeSection', this)"><span>üè†</span>Home</button>
    <button class="nav-item" onclick="switchSection('ordersSection', this)"><span>üì¶</span>Orders</button>
    <button class="nav-item" onclick="switchSection('cartSection', this)"><span>üõí</span>Cart</button>
    <button class="nav-item" onclick="switchSection('profileSection', this)"><span>üë§</span>Profile</button>
</div>

<script>
const SUPABASE_URL = "https://urrqpsmhlzldtxzstnuu.supabase.co";
const SUPABASE_KEY = "sb_publishable_OmqQDQdf7ye8KXbviwFYng_zPdbZpWb";
const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const ADMIN_EMAIL = "ligerplaz@gmail.com";
let cart = [], currentUser = null, isAdmin = false, currentPayment = 'COD', userOrders = [], editingId = null, currentBase64 = "";

let allProducts = Array.from({length: 20}, (_, i) => ({
    id: i+1, name: `Premium Product ${i+1}`, price: 1500 + (i*200), img: `https://picsum.photos/id/${i+55}/400/400`
}));

function showToast(msg) {
    const t = document.getElementById('customToast');
    t.innerText = msg; t.style.display = 'block';
    setTimeout(() => t.style.display = 'none', 3000);
}

function previewAdminImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            currentBase64 = e.target.result;
            const img = document.getElementById('adminPreview');
            img.src = currentBase64; img.style.display = "block";
        }
        reader.readAsDataURL(input.files[0]);
    }
}

async function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const pass = document.getElementById('loginPass').value;
    document.getElementById('loaderOverlay').style.display = 'flex';
    const { data, error } = await _supabase.auth.signInWithPassword({ email, password: pass });
    document.getElementById('loaderOverlay').style.display = 'none';
    if(error) showToast(error.message);
    else {
        currentUser = data.user; isAdmin = (email === ADMIN_EMAIL);
        document.getElementById('authPage').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('bottomNav').style.display = 'flex';
        document.getElementById('supportBtn').style.display = 'flex';
        document.getElementById('displayEmail').innerText = email;
        if(isAdmin) document.getElementById('adminDashboard').style.display = 'block';
        loadProducts();
    }
}

async function handleSignup() {
    const email = document.getElementById('loginEmail').value;
    const pass = document.getElementById('loginPass').value;
    document.getElementById('loaderOverlay').style.display = 'flex';
    const { error } = await _supabase.auth.signUp({ email, password: pass });
    document.getElementById('loaderOverlay').style.display = 'none';
    if(error) showToast(error.message); else showToast("Verify Email!");
}

function loadProducts() {
    document.getElementById('products').innerHTML = allProducts.map(p => `
        <div class="card">
            <div class="admin-edit-bar" style="display:${isAdmin?'flex':'none'}">
                <button onclick="editProduct(${p.id})">EDIT</button>
                <button onclick="deleteProduct(${p.id})">DELETE</button>
            </div>
            <img src="${p.img}">
            <div class="card-info"><h4>${p.name}</h4><span class="price-tag">Rs ${p.price}</span></div>
            <div class="btn-group">
                <button class="btn-small btn-cart" onclick="addToCart(${p.id})">Add to Cart</button>
                <button class="btn-small btn-order" onclick="buyNow(${p.id})">Place Order</button>
            </div>
        </div>`).join('');
}

function addNewProduct() {
    const name = document.getElementById('pName').value;
    const price = document.getElementById('pPrice').value;
    if(!name || !price || !currentBase64) return showToast("Enter Details & Image!");
    allProducts.unshift({ id: Date.now(), name, price, img: currentBase64 });
    resetAdminPanel(); loadProducts(); showToast("Added!");
}

function editProduct(id) {
    const p = allProducts.find(x => x.id === id);
    document.getElementById('pName').value = p.name;
    document.getElementById('pPrice').value = p.price;
    editingId = id;
    document.getElementById('adminActionBtn').innerText = "Update Product";
    document.getElementById('adminActionBtn').onclick = saveUpdate;
    window.scrollTo(0, document.body.scrollHeight);
}

function saveUpdate() {
    const p = allProducts.find(x => x.id === editingId);
    p.name = document.getElementById('pName').value;
    p.price = document.getElementById('pPrice').value;
    if(currentBase64) p.img = currentBase64;
    resetAdminPanel(); loadProducts(); showToast("Updated!");
}

function deleteProduct(id) {
    allProducts = allProducts.filter(p => p.id !== id);
    loadProducts(); showToast("Deleted!");
}

function resetAdminPanel() {
    editingId = null; currentBase64 = "";
    document.getElementById('pName').value = "";
    document.getElementById('pPrice').value = "";
    document.getElementById('pImgFile').value = "";
    document.getElementById('adminPreview').style.display = "none";
    document.getElementById('adminActionBtn').innerText = "Add Product";
    document.getElementById('adminActionBtn').onclick = addNewProduct;
}

function addToCart(id) {
    const p = allProducts.find(x => x.id === id);
    cart.push({...p, cartId: Date.now()}); updateCart(); showToast("Added!");
}

function buyNow(id) {
    const p = allProducts.find(x => x.id === id);
    cart = [{...p, cartId: Date.now()}]; updateCart(); switchSection('cartSection');
}

function updateCart() {
    let total = 0;
    document.getElementById('cartItems').innerHTML = cart.map(i => {
        total += i.price;
        return `<div style="padding:10px; background:#fff; border-radius:8px; margin-bottom:5px;">${i.name} - Rs ${i.price}</div>`;
    }).join('');
    document.getElementById('cartTotal').innerText = total;
}

function setPayment(type) {
    currentPayment = type;
    document.querySelectorAll('.payment-method').forEach(e => e.classList.remove('active'));
    document.getElementById(type === 'COD' ? 'pay-cod' : 'pay-ep').classList.add('active');
    document.getElementById('paymentInstructions').style.display = (type === 'JazzCash') ? 'block' : 'none';
}

function initiateOrder() {
    const phone = document.getElementById('orderPhone').value;
    const name = document.getElementById('orderName').value;
    if(cart.length === 0 || !phone || !name) return showToast("Fill All Details!");
    
    const newOrder = {
        id: 'ORD-'+Math.floor(Math.random()*9999), user: currentUser.email, 
        uName: name, uPhone: phone, items: [...cart], total: document.getElementById('cartTotal').innerText, status: 'Pending'
    };
    userOrders.unshift(newOrder);
    if(isAdmin) showToast("ADMIN: New Order Recieved!");
    
    if(currentPayment === 'JazzCash') {
        document.getElementById('checkoutForm').style.display = 'none';
        document.getElementById('proofSection').style.display = 'block';
    } else { finalizeOrder(); }
}

function submitProof() {
    showToast("Proof Sent!"); finalizeOrder();
}

function finalizeOrder() {
    showToast("Order Placed!");
    cart = []; updateCart(); renderOrders();
    document.getElementById('proofSection').style.display = 'none';
    document.getElementById('checkoutForm').style.display = 'block';
    switchSection('ordersSection');
}

function renderOrders() {
    document.getElementById('userOrdersList').innerHTML = userOrders.map(o => `
        <div style="background:white; padding:15px; border-radius:10px; margin-bottom:10px; border-left:5px solid orange">
            <b>${o.id}</b> | Total: Rs ${o.total}<br>
            <button style="background:red; color:white; border:none; padding:5px; margin-top:5px" onclick="cancelOrder('${o.id}')">Cancel</button>
        </div>`).join('');
    if(isAdmin) renderAdminOrders();
}

function renderAdminOrders() {
    document.getElementById('adminOrdersList').innerHTML = userOrders.map(o => `<div style="font-size:11px; border-bottom:1px solid #ddd; padding:5px;">${o.uName} (${o.uPhone}) - ${o.total}</div>`).join('');
}

function cancelOrder(id) {
    userOrders = userOrders.filter(o => o.id !== id);
    showToast("Cancelled!"); renderOrders();
}

function saveAddress() {
    const a = document.getElementById('newAddr').value;
    if(a) { 
        document.getElementById('savedAddresses').innerHTML += `<div class="payment-method">${a}</div>`;
        document.getElementById('addressList').innerHTML += `<div class="payment-method">${a}</div>`;
        document.getElementById('newAddr').value = "";
    }
}

function switchSection(id, btn) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';
    if(btn) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
        btn.classList.add('nav-active');
    }
}

function searchProducts() {
    const t = searchBar.value.toLowerCase();
    const f = allProducts.filter(p => p.name.toLowerCase().includes(t));
    document.getElementById('products').innerHTML = f.map(p => `
        <div class="card"><img src="${p.img}"><div class="card-info"><h4>${p.name}</h4><span class="price-tag">Rs ${p.price}</span></div><div class="btn-group"><button class="btn-small btn-cart" onclick="addToCart(${p.id})">Add to Cart</button><button class="btn-small btn-order" onclick="buyNow(${p.id})">Place Order</button></div></div>`).join('');
}
</script>
</body>
</html>
